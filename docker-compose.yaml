version: '3'
  
services:
  build:
    profiles: ['build']
    build: .
    image: ${IMAGE}
   
  startproject:
    profiles: ['init']
    image: ${IMAGE}
    volumes:
      - ${BASEDIR_HOST}:${BASEDIR}
    working_dir: ${BASEDIR}
    command: django-admin startproject ${PROJECT}
    
  startapp:
    profiles: ['init']
    image: ${IMAGE}
    volumes:
      - ${BASEDIR_HOST}:${BASEDIR}
    working_dir: ${BASEDIR}
    command: django-admin startapp ${APP}
    
  run:
    image: ${IMAGE}
    ports:
      - "8000:8000"
    volumes:
      - ${BASEDIR_HOST}:/${BASEDIR}
    working_dir: ${BASEDIR}
    command: python3 ${BASEDIR}/manage.py runserver 0.0.0.0:8000
    
  migrate:
    image: ${IMAGE}
    volumes:
      - ${BASEDIR_HOST}:/${BASEDIR}
    working_dir: ${BASEDIR}
    command: python3 ${BASEDIR}/manage.py migrate
